<head>
  <style>
    *,
    *::before,
    *::after {
      box-sizing: inherit;
      padding: 0;
      margin: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, San Francisco,
        Helvetica Neue, Helvetica, Ubuntu, Roboto, Noto, Segoe UI, Arial,
        sans-serif;
      font-size: 1.2rem;
      line-height: 1.5;
      color: #111;
    }

    main {
      max-width: 720px;
      width: 100%;
      border: 2.5px solid #04220e;
      border-radius: 2.5px;
      box-shadow: 0 10px 20px rgba(17, 17, 17, 0.125),
        0 5px 5px rgba(17, 17, 17, 0.25);
      background-image: linear-gradient(to top, #848a55 0%, #0b4203 100%);
      margin: 4rem auto;
    }

    h1 {
      padding: 1rem;
      color: white;
    }

    #h2 {
      margin: 1rem;
    }

    input,
    button {
      font-family: inherit;
      line-height: inherit;
      color: inherit;
      border: 0;
      padding: 1rem;
    }

    input {
      box-sizing: border-box;
      width: 100%;
    }

    .buttons {
      display: flex;
    }

    button {
      cursor: pointer;
      flex: 1;
      background-color: transparent;
      color: white;
      &:hover {
        background-color: rgba(255, 255, 255, 0.5);
      }
    }

    #shorten {
      text-transform: uppercase;
      color: #f5f1f1;
      font-size: 1.1rem;
    }

    section {
      min-height: 120px;
      text-align: center;
      background-color: white;
    }

    .hidden {
      display: none;
    }

    svg {
      width: 20px;
      height: 20px;
      margin-right: 7px;
    }

    button,
    .button {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      height: auto;
      padding-top: 8px;
      padding-bottom: 8px;
      color: #777;
      text-align: center;
      font-size: 14px;
      font-weight: 500;
      line-height: 1.1;
      letter-spacing: 2px;
      text-transform: capitalize;
      text-decoration: none;
      white-space: nowrap;
      border-radius: 4px;
      border: 1px solid #ddd;
      cursor: pointer;
    }

    button:hover,
    .button:hover {
      border-color: #cdd;
    }

    .share-button,
    .copy-link {
      padding-left: 30px;
      padding-right: 30px;
    }

    .share-button {
      margin: 1rem;
    }

    .share-dialog {
      position: absolute;
      top: 10%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    .share-dialog {
      display: none;
      width: 95%;
      max-width: 500px;
      box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
      z-index: -1;
      border: 1px solid #ddd;
      padding: 20px;
      border-radius: 4px;
      background-color: #fff;
    }

    .share-dialog.is-open {
      display: block;
      z-index: 2;
    }

    header {
      display: flex;
      justify-content: space-between;
      margin-bottom: 20px;
    }

    .targets {
      display: grid;
      grid-template-rows: 1fr 1fr;
      grid-template-columns: 1fr 1fr;
      grid-gap: 20px;
      margin-bottom: 20px;
    }

    .close-button {
      background-color: transparent;
      border: none;
      padding: 0;
    }

    .close-button svg {
      margin-right: 0;
    }

    .link {
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 10px;
      border-radius: 4px;
      background-color: #eee;
    }

    .pen-url {
      margin-right: 15px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
  </style>
</head>
<main>
  <h1>URL Shortener</h1>
  <form id="post-form">
    {% csrf_token %}
    <input
      type="text"
      name="link"
      id="link"
      required
      placeholder="Enter URL here"
    />
    <div class="buttons">
      <button type="submit" id="shorten">Shorten</button>
    </div>
  </form>
  <section id="section">
    <h2 id="h2"></h2>
    <div class="share-dialog">
      <header>
        <h3 class="dialog-title">Share this link</h3>
        <button class="close-button">
          <svg><use href="#close"></use></svg>
        </button>
      </header>
      <div class="targets">
        <a class="button">
          <svg>
            <use href="#facebook"></use>
          </svg>
          <span>Facebook</span>
        </a>

        <a class="button">
          <svg>
            <use href="#twitter"></use>
          </svg>
          <span>Twitter</span>
        </a>

        <a class="button">
          <svg>
            <use href="#linkedin"></use>
          </svg>
          <span>LinkedIn</span>
        </a>

        <a class="button">
          <svg>
            <use href="#email"></use>
          </svg>
          <span>Email</span>
        </a>
      </div>
      <div class="link">
        <input type="text" class="pen-url" disabled />
        <button class="copy-link">Copy Link</button>
      </div>
    </div>

    <button
      class="share-button hidden"
      type="button"
      title="Share this article"
    >
      <svg>
        <use href="#share-icon"></use>
      </svg>
      <span>Share</span>
    </button>

    <svg class="hidden">
      <defs>
        <symbol
          id="share-icon"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-share"
        >
          <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path>
          <polyline points="16 6 12 2 8 6"></polyline>
          <line x1="12" y1="2" x2="12" y2="15"></line>
        </symbol>

        <symbol
          id="facebook"
          viewBox="0 0 24 24"
          fill="#3b5998"
          stroke="#3b5998"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-facebook"
        >
          <path
            d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"
          ></path>
        </symbol>

        <symbol
          id="twitter"
          viewBox="0 0 24 24"
          fill="#1da1f2"
          stroke="#1da1f2"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-twitter"
        >
          <path
            d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"
          ></path>
        </symbol>

        <symbol
          id="email"
          viewBox="0 0 24 24"
          fill="#777"
          stroke="#fafafa"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-mail"
        >
          <path
            d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"
          ></path>
          <polyline points="22,6 12,13 2,6"></polyline>
        </symbol>

        <symbol
          id="linkedin"
          viewBox="0 0 24 24"
          fill="#0077B5"
          stroke="#0077B5"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-linkedin"
        >
          <path
            d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"
          ></path>
          <rect x="2" y="9" width="4" height="12"></rect>
          <circle cx="4" cy="4" r="2"></circle>
        </symbol>

        <symbol
          id="close"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="feather feather-x-square"
        >
          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="9" y1="9" x2="15" y2="15"></line>
          <line x1="15" y1="9" x2="9" y2="15"></line>
        </symbol>
      </defs>
    </svg>
  </section>
</main>

<script type="text/javascript">
  const postForm = document.getElementById("post-form");
  const linkInput = document.getElementById("link");
  const tokenInput = document.querySelector("input[name=csrfmiddlewaretoken]");
  const h2 = document.getElementById("h2");

  const shareButton = document.querySelector(".share-button");
  const shareDialog = document.querySelector(".share-dialog");
  const closeButton = document.querySelector(".close-button");
  const copyButton = document.querySelector(".copy-link");
  const shareUrl = document.querySelector(".pen-url");

  postForm.addEventListener("submit", (e) => {
    e.preventDefault();
    const data = {
      link: linkInput.value,
    };
    postData(data);
  });

  const postData = async (data) => {
    try {
      const response = await fetch("/create", {
        method: "POST",
        headers: {
          "X-CSRFToken": tokenInput.value,
          Accept: "application/json",
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      });

      const decoder = new TextDecoder("utf-8");
      if (response.ok) {
        await response.body
          .getReader()
          .read()
          .then(({ value, done }) => {
            const code = decoder.decode(value);
            h2.innerHTML = "www.zurl.tk/" + code;
            shareUrl.value = "www.zurl.tk/" + code;
          });
        shareButton.classList.remove("hidden");
      }
    } catch (error) {
      shareButton.classList.add("hidden");
      return console.error(error);
    }
  };

  shareButton.addEventListener("click", (event) => {
    if (navigator.share) {
      navigator
        .share({
          title: "URL Shortener",
          url: shareUrl.value,
        })
        .then(() => {
          console.log("Thanks for sharing!");
        })
        .catch(console.error);
    } else {
      shareDialog.classList.add("is-open");
    }
  });

  closeButton.addEventListener("click", (event) => {
    shareDialog.classList.remove("is-open");
  });

  copyButton.addEventListener("click", (event) => {
    if (!navigator.clipboard) {
      copyFn(shareUrl);
      return;
    }

    navigator.clipboard.writeText(shareUrl.value).then(
      function () {
        console.log("Async: Copying to clipboard was successful!");
      },
      function (err) {
        console.error("Async: Could not copy text: ", err);
      }
    );
  });

  const copyFn = async (input) => {
    input.disabled = false;
    await input.select();

    try {
      const successful = await document.execCommand("copy");
      const msg = successful ? "successful" : "unsuccessful";
      console.log("Copy command was " + msg);
      shareUrl.disabled = true;
    } catch (err) {
      console.log("Oops, unable to copy");
      shareUrl.disabled = true;
    }

    window.getSelection().removeAllRanges();
  };
</script>
